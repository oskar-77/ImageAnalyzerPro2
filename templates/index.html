{% extends "base.html" %}

{% block title %}Mr.OSKAR - Advanced Image Processing Platform{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="text-center mb-5">
            <div class="hero-section">
                <h1 class="display-3 fw-bold mb-3">
                    <i class="fas fa-microscope text-primary me-3 rotating-icon"></i>
                    <span class="text-gradient-hero">Mr.OSKAR</span>
                </h1>
                <h2 class="h4 text-primary mb-3">Advanced Image Processing Platform</h2>
                <p class="lead text-muted mb-4">
                    Unleash the power of computer vision with our comprehensive suite of image analysis tools.
                    From pixel-level exploration to advanced statistical analysis.
                </p>
                <div class="features-badges mb-4">
                    <span class="badge bg-primary me-2 p-2">
                        <i class="fas fa-eye me-1"></i>Computer Vision
                    </span>
                    <span class="badge bg-success me-2 p-2">
                        <i class="fas fa-chart-line me-1"></i>Statistical Analysis
                    </span>
                    <span class="badge bg-info me-2 p-2">
                        <i class="fas fa-palette me-1"></i>Image Processing
                    </span>
                    <span class="badge bg-warning me-2 p-2">
                        <i class="fas fa-cogs me-1"></i>Real-time Processing
                    </span>
                </div>
                <p class="text-muted">
                    <i class="fas fa-user-tie text-primary me-2"></i>
                    Developed by <strong class="text-primary">Eng. Abdulrazzaq Al-Surabi</strong>
                </p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Single Image Analysis -->
    <div class="col-lg-6 mb-4">
        <div class="card h-100">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="fas fa-search-plus text-primary me-2"></i>
                    Advanced Image Analysis
                </h5>
                <p class="card-text">
                    Upload any image to explore pixel values, generate comprehensive statistics, create interactive histograms, and apply sophisticated image processing techniques.
                </p>
                <ul class="list-unstyled small text-muted">
                    <li><i class="fas fa-check-circle text-success me-1"></i> Pixel-level exploration</li>
                    <li><i class="fas fa-check-circle text-success me-1"></i> Color space conversions</li>
                    <li><i class="fas fa-check-circle text-success me-1"></i> Statistical analysis</li>
                    <li><i class="fas fa-check-circle text-success me-1"></i> Interactive visualizations</li>
                </ul>
                
                <form action="{{ url_for('upload_file') }}" method="POST" enctype="multipart/form-data" class="mt-3">
                    <div class="mb-3">
                        <label for="imageFile" class="form-label">Choose Image File</label>
                        <input type="file" class="form-control" id="imageFile" name="file" accept="image/*" required>
                        <div class="form-text">
                            Supported formats: PNG, JPG, JPEG, GIF, BMP, TIFF, WEBP (Max: 16MB)
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-upload me-2"></i>Upload & Analyze
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Image Comparison -->
    <div class="col-lg-6 mb-4">
        <div class="card h-100">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="fas fa-copy text-success me-2"></i>
                    Intelligent Image Comparison
                </h5>
                <p class="card-text">
                    Compare two images using advanced metrics including SSIM, PSNR, MSE, and structural similarity. Generate comprehensive difference maps and detailed analysis reports.
                </p>
                <ul class="list-unstyled small text-muted">
                    <li><i class="fas fa-check-circle text-success me-1"></i> SSIM & PSNR metrics</li>
                    <li><i class="fas fa-check-circle text-success me-1"></i> Difference visualization</li>
                    <li><i class="fas fa-check-circle text-success me-1"></i> Quality assessment</li>
                    <li><i class="fas fa-check-circle text-success me-1"></i> Detailed reports</li>
                </ul>
                
                <form id="compareForm" class="mt-3">
                    <div class="mb-3">
                        <label for="imageFile1" class="form-label">First Image</label>
                        <input type="file" class="form-control" id="imageFile1" name="file1" accept="image/*" required>
                    </div>
                    <div class="mb-3">
                        <label for="imageFile2" class="form-label">Second Image</label>
                        <input type="file" class="form-control" id="imageFile2" name="file2" accept="image/*" required>
                    </div>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-compare me-2"></i>Compare Images
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Features Overview -->
<div class="row mt-5">
    <div class="col-12">
        <h2 class="text-center mb-4 text-gradient-section">
            <i class="fas fa-star text-warning me-2"></i>
            Powerful Features at Your Fingertips
        </h2>
    </div>
    
    <div class="col-md-3 mb-4">
        <div class="card text-center">
            <div class="card-body">
                <i class="fas fa-crosshairs fa-3x text-primary mb-3 feature-icon"></i>
                <h5 class="card-title">Precision Pixel Analysis</h5>
                <p class="card-text">Interactive pixel exploration with RGB, HSV, LAB color spaces and comprehensive brightness analysis.</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-4">
        <div class="card text-center">
            <div class="card-body">
                <i class="fas fa-chart-line fa-3x text-success mb-3 feature-icon"></i>
                <h5 class="card-title">Advanced Statistics</h5>
                <p class="card-text">In-depth statistical analysis including brightness distribution, multi-channel histograms, and texture characterization.</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-4">
        <div class="card text-center">
            <div class="card-body">
                <i class="fas fa-magic fa-3x text-warning mb-3 feature-icon"></i>
                <h5 class="card-title">Smart Conversions</h5>
                <p class="card-text">Seamless format conversions: RGB, Grayscale, Binary, HSV color spaces with optimized algorithms.</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-4">
        <div class="card text-center">
            <div class="card-body">
                <i class="fas fa-file-export fa-3x text-info mb-3 feature-icon"></i>
                <h5 class="card-title">Professional Reports</h5>
                <p class="card-text">Generate comprehensive analysis reports with visualizations in multiple formats (TXT, PNG, PDF).</p>
            </div>
        </div>
    </div>
</div>

<!-- Comparison Results Modal -->
<div class="modal fade" id="comparisonModal" tabindex="-1" aria-labelledby="comparisonModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="comparisonModalLabel">
                    <i class="fas fa-balance-scale me-2"></i>Image Comparison Results
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="comparisonResults">
                    <!-- Comparison results will be loaded here -->
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const compareForm = document.getElementById('compareForm');
    const comparisonModal = new bootstrap.Modal(document.getElementById('comparisonModal'));
    
    compareForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(compareForm);
        const file1 = formData.get('file1');
        const file2 = formData.get('file2');
        
        if (!file1 || !file2) {
            alert('Please select both images for comparison.');
            return;
        }
        
        // Show loading state
        const submitBtn = compareForm.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Comparing...';
        submitBtn.disabled = true;
        
        // Submit comparison request
        fetch('/api/compare', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert('Error: ' + data.error);
            } else {
                displayComparisonResults(data);
                comparisonModal.show();
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred during comparison.');
        })
        .finally(() => {
            // Restore button state
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        });
    });
    
    function displayComparisonResults(data) {
        const resultsDiv = document.getElementById('comparisonResults');
        
        let html = `
            <div class="row">
                <div class="col-md-4">
                    <h6>Original Images</h6>
                    <img src="/static/uploads/${data.image1}" class="img-fluid mb-2" alt="Image 1">
                    <img src="/static/uploads/${data.image2}" class="img-fluid" alt="Image 2">
                </div>
                <div class="col-md-8">
                    <h6>Similarity Metrics</h6>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">SSIM</h5>
                                    <p class="card-text">
                                        <strong>${(data.ssim.ssim * 100).toFixed(2)}%</strong><br>
                                        <small class="text-muted">${data.ssim.interpretation}</small>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">PSNR</h5>
                                    <p class="card-text">
                                        <strong>${data.psnr.psnr.toFixed(2)} dB</strong><br>
                                        <small class="text-muted">${data.psnr.interpretation}</small>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-sm-6">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">MSE</h5>
                                    <p class="card-text">
                                        <strong>${data.mse.mse.toFixed(2)}</strong><br>
                                        <small class="text-muted">${data.mse.interpretation}</small>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">Overall</h5>
                                    <p class="card-text">
                                        <strong>${data.overall_similarity.percentage.toFixed(1)}%</strong><br>
                                        <small class="text-muted">${data.overall_similarity.interpretation}</small>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        if (data.difference_map) {
            html += `
                <div class="row mt-4">
                    <div class="col-12">
                        <h6>Difference Map</h6>
                        <img src="/static/uploads/${data.difference_map}" class="img-fluid" alt="Difference Map">
                    </div>
                </div>
            `;
        }
        
        resultsDiv.innerHTML = html;
    }
});
</script>
{% endblock %}
